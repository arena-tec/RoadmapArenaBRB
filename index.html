<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roadmap Arena BRB</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #EBF4FF 0%, #D6E8FF 100%); 
      padding: 20px;
      min-height: 100vh;
    }
    .container { max-width: 1800px; margin: 0 auto; }
    
    /* Header */
    .header { 
      background: linear-gradient(135deg, #4324C4 0%, #0E76E0 100%); 
      border-radius: 12px; 
      padding: 30px; 
      margin-bottom: 30px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
      display: flex; 
      align-items: center; 
      gap: 20px; 
    }
    .header img { height: 50px; }
    .header-text { flex: 1; }
    .header h1 { font-size: 36px; color: #ffffff; margin-bottom: 8px; font-weight: 700; }
    .header p { color: #ffffff; opacity: 0.9; font-size: 16px; }
    .firebase-status {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255,255,255,0.2);
      padding: 10px 20px;
      border-radius: 50px;
      backdrop-filter: blur(10px);
    }
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #EF4444;
      animation: pulse 2s infinite;
    }
    .status-dot.connected { background: #10B981; }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .status-text {
      color: white;
      font-size: 14px;
      font-weight: 600;
    }
    
    /* Save message */
    .save-message {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 8px;
      font-weight: bold;
      z-index: 1000;
      display: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .save-message.success { background: #D1FAE5; color: #065F46; }
    .save-message.error { background: #FEE2E2; color: #991B1B; }
    
    /* Stats */
    .stats { 
      display: grid; 
      grid-template-columns: repeat(2, 1fr); 
      gap: 20px; 
      margin-bottom: 30px; 
    }
    .stat-card { 
      background: white; 
      border-radius: 12px; 
      padding: 30px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .stat-value { font-size: 48px; font-weight: 700; color: #0E76E0; margin-top: 10px; }
    .stat-label { color: #6B7280; font-size: 14px; font-weight: 600; text-transform: uppercase; }
    
    /* Total card */
    .total-card { 
      background: linear-gradient(135deg, #4324C4 0%, #0E76E0 100%); 
      color: white; 
      border-radius: 12px; 
      padding: 40px; 
      text-align: center; 
      margin-bottom: 30px; 
      box-shadow: 0 4px 12px rgba(67, 36, 196, 0.3);
    }
    .total-card-value { font-size: 72px; font-weight: 700; margin: 15px 0; }
    
    /* Section */
    .section { 
      background: white; 
      border-radius: 12px; 
      padding: 30px; 
      margin-bottom: 30px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .section-title { 
      font-size: 24px; 
      font-weight: 700; 
      color: #1F2937; 
      margin-bottom: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* BotÃµes */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    .btn-primary { background: #0E76E0; color: white; }
    .btn-secondary { background: #4324C4; color: white; }
    
    /* Roadmap */
    .roadmap-container { 
      overflow-x: auto; 
      margin-top: 20px;
      border-radius: 8px;
      background: #F9FAFB;
      padding: 20px;
    }
    .roadmap { 
      min-width: 1400px;
    }
    
    .roadmap-header {
      display: flex;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 3px solid #E5E7EB;
    }
    
    .projeto-row {
      display: flex;
      margin-bottom: 15px;
      border-radius: 8px;
      overflow: hidden;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .projeto-label {
      width: 200px;
      padding: 15px;
      font-size: 13px;
      font-weight: 700;
      color: #1F2937;
    }
    
    .projeto-timeline {
      flex: 1;
      position: relative;
      min-height: 70px;
      background: linear-gradient(to right, #FAFAFA 0%, #F3F4F6 100%);
      border-left: 2px solid #E5E7EB;
    }
    
    .mes-col {
      position: absolute;
      top: 0;
      bottom: 0;
      border-right: 1px dashed #D1D5DB;
    }
    
    .tarefa-box {
      position: absolute;
      height: 50px;
      border-radius: 6px;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      font-size: 13px;
      font-weight: 600;
      color: #1F2937;
      border: 2px solid rgba(0,0,0,0.1);
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal.show { display: flex; }
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 35px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .modal-title { font-size: 24px; font-weight: 700; margin-bottom: 25px; }
    .form-group { margin-bottom: 20px; }
    .form-group label { 
      display: block; 
      margin-bottom: 8px; 
      font-weight: 600; 
      font-size: 14px;
    }
    .form-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #E5E7EB;
      border-radius: 8px;
      font-size: 15px;
    }
    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }
    .modal-actions button { flex: 1; }
    
    /* Floating button */
    .floating-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      padding: 18px 32px;
      border: none;
      border-radius: 50px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      background: #10B981;
      color: white;
      z-index: 999;
    }
  </style>
</head>
<body>
  <div id="saveMessage" class="save-message"></div>
  
  <div class="container">
    <!-- Header -->
    <div class="header">
      <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iOTcuNzExIiBoZWlnaHQ9IjQzLjA1IiB2aWV3Qm94PSIwIDAgOTcuNzExIDQzLjA1Ij4KICA8ZGVmcz4KICAgIDxjbGlwUGF0aCBpZD0iYSI+CiAgICAgIDxyZWN0IHdpZHRoPSI5Ny43MTEiIGhlaWdodD0iNDMuMDUiIGZpbGw9Im5vbmUiPjwvcmVjdD4KICAgIDwvY2xpcFBhdGg+CiAgPC9kZWZzPgogIDxnIGNsaXAtcGF0aD0idXJsKCNhKSI+CiAgICA8cGF0aCBkPSJNMTMuNDY5LDU2LjUyNGwtLjQxNywyLjY2MmEyOS4zMTcsMjkuMzE3LDAsMCwxLDE1LjIzLDguMzYybDYuMDgxLTMuOTkzcy43LS40NzMsMS4wMjgtLjA3N2MwLDAsLjMxOS4zMDgtLjI5Mi45NjdsLTQuOTk0LDUuMTc5YTI5LjE5MSwyOS4xOTEsMCwwLDEsNi4zMTgsMTUuNzI0aDIuODQ2bDQuNTA5LTI4LjgyNloiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC05Ljc2OCAtNDIuMykiIGZpbGw9IiNmZmYiPjwvcGF0aD4KICAgIDxwYXRoIGQ9Ik0xNDkuMTA2LDY4LjMwOEgxNDUuNDhsMS4xODktNy40OTJoNC4xYzIuMzYyLDAsMi43Ny4yMTcsMy4xMzQuNzEyYTIuNjQzLDIuNjQzLDAsMCwxLC40NDUsMS42NjMsNC45LDQuOSwwLDAsMS01LjI0MSw1LjExN20yLjQ3MSwxMS44ODJjLTEuMDMuNzA4LTEuNzA3LjkxNC00LjIxNS45MTRoLTMuODhsMS4yOC04LjI4MWg0LjA5NWMzLjk1OSwwLDQuNDkzLDEuNzQ4LDQuNDkzLDMuNDU2YTQuNiw0LjYsMCwwLDEtMS43NzMsMy45MTFtMy4zODYtMTBhOC4yNzcsOC4yNzcsMCwwLDAsNC40ODItNy4zMzQsNi4xNzEsNi4xNzEsMCwwLDAtMS43LTQuNDgzYy0xLjI4Mi0xLjMyOC0yLjgzNy0xLjgyNS01LjczMS0xLjgyNWgtOS40ODdsLS4wOTIuNTg5LTMuNywyMy40NzZjLS4yNzIsMS43MTYtLjA0NSw0LjczNywzLjczLDQuNzUxdjBoNi41MTlhOSw5LDAsMCwwLDkuNDIzLTkuMzgxLDYuMTE2LDYuMTE2LDAsMCwwLTMuNDQxLTUuOCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEwMy43NjQgLTQyLjMyMSkiIGZpbGw9IiNmZmYiPjwvcGF0aD4KICAgIDxwYXRoIGQ9Ik0yMjguODY1LDY5LjM0OGwxLjM1Ni04LjUzMmgzLjg1YzMuNTUzLDAsNC4yLjk1NCw0LjIsMi44MzNhNS40MzYsNS40MzYsMCwwLDEtNS43ODMsNS43Wm02LjkzNywzLjYzNGE5LjQ1Miw5LjQ1MiwwLDAsMCw3LjMxOS05LjMzM2MwLTQuNTc3LTIuODU5LTcuMS04LjA1Mi03LjFoLTguOTkybC0uMDkyLjU5Mi0zLjgsMjQuMzg1Yy0uMTY5LDEuMjQ5LTEuMTEzLDMuODQzLDMuNDE5LDMuODQxbC40MzcsMGguMzE3bC4wOTQtLjU5MiwxLjczNi0xMS4xNjZoMi42MThsNS41NDIsMTEuMzY1LjE5Mi4zOTRoNS40NzZsLS41MDgtMS4wMTNaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTY2LjEzMiAtNDIuMzIxKSIgZmlsbD0iI2ZmZiI+PC9wYXRoPgogICAgPHBhdGggZD0iTTMxNi4xODksNjguMzA4aC0zLjYyN2wxLjE5MS03LjQ5Mmg0LjFjMi4zNjMsMCwyLjc3LjIxNywzLjEzNC43MTJhMi42NDksMi42NDksMCwwLDEsLjQ0NiwxLjY2Myw0LjksNC45LDAsMCwxLTUuMjQyLDUuMTE3bTIuNDcsMTEuODgyYy0xLjAyOC43MDgtMS43MDYuOTE0LTQuMjE0LjkxNGgtMy44NzlsMS4yNzktOC4yODFoNC4wOTRjMy45NjEsMCw0LjQ5NSwxLjc0OCw0LjQ5NSwzLjQ1NmE0LjYsNC42LDAsMCwxLTEuNzc0LDMuOTExbTMuMzg2LTEwYTguMjc2LDguMjc2LDAsMCwwLDQuNDgxLTcuMzM0LDYuMTY3LDYuMTY3LDAsMCwwLTEuNy00LjQ4M2MtMS4yODItMS4zMjktMi44MzgtMS44MjUtNS43MzEtMS44MjVoLTkuNDg5bC0uMDkyLjU5LTMuNjkyLDIzLjQyNGMtLjI0NCwxLjctLjA4OCw0Ljc4NywzLjcyNSw0Ljh2MGg2LjUxNmE5LDksMCwwLDAsOS40MjUtOS4zODEsNi4xMTQsNi4xMTQsMCwwLDAtMy40NDQtNS43OTUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMjguODE2IC00Mi4zMjEpIiBmaWxsPSIjZmZmIj48L3BhdGg+CiAgICA8cGF0aCBkPSJNOS41MjQsOTQuNjE1bC0uMjc4LS4zMzYsNi41LTcuMzA2QTI2LjA0OSwyNi4wNDksMCwwLDAsMi43NzgsNzkuOTg1TC4xMjcsOTYuOTI4Yy0uNDYyLDMuMTc3LjExNSw1Ljk3OCw1LjQxMSw1Ljk3OEgyMy4zNjZhMjUuOTM5LDI1LjkzOSwwLDAsMC01LjMyNy0xMy4zNTlaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIC01OS44NTkpIiBmaWxsPSIjZmZmIj48L3BhdGg+CiAgICA8cGF0aCBkPSJNMTYyLjY2MS4wODcsMTU3LjU0LDkuMDY2YS43MjguNzI4LDAsMCwwLC42MzMsMS4wOWguMmwxLjM1Ni0yLjM5MWg0LjEwOWwuMzUsMi4zOTFoMS40MUwxNjQuMTIyLjA4N1ptLjQ3OSwyLjYwNy41NzksMy45MzloLTMuMzkzbDIuMjM2LTMuOTI3Yy4xODEtLjMwOS4zMy0uNi40NzctLjkwOS4wMjYuMy4wNi42LjEuOSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTExNy44MjYgLTAuMDY1KSIgZmlsbD0iI2ZmZiI+PC9wYXRoPgogICAgPHBhdGggZD0iTTM1OS43NTgsOS45NTgsMzU4LjMzMi4yMzRhLjE3My4xNzMsMCwwLDAtLjE3LS4xNDdoLTEuMjEzYS4xNzMuMTczLDAsMCwwLS4xNDkuMDg3bC01LjAyMSw4LjhhLjc4OC43ODgsMCwwLDAsLjY4NCwxLjE3OC4xNzMuMTczLDAsMCwwLC4xNS0uMDg3bDEuMzA2LTIuM2g0LjEwOWwuMzI4LDIuMjQ0YS4xNzMuMTczLDAsMCwwLC4xNy4xNDdoMS4wNjJhLjE3Mi4xNzIsMCwwLDAsLjE3LS4ybS0yLjQzLTcuMjY0LjU3OSwzLjkzOWgtMy4zOTNsMi4yMzYtMy45MjdjLjE4MS0uMzA5LjMzLS42LjQ3Ny0uOTA5LjAyNi4zLjA2LjYuMS45IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjYzLjE4MyAtMC4wNjUpIiBmaWxsPSIjZmZmIj48L3BhdGg+CiAgICA8cGF0aCBkPSJNMjIwLjA3NSwyLjE4NWMwLS44MTYtLjQtMi4xODQtMy4wNzMtMi4xODQtLjk2NSwwLTEuODA5LjAxNS0yLjQ0LjA0NGwtLjA4NywwLTEuOTE2LDkuMDQzYS44NDUuODQ1LDAsMCwwLC44MjcsMS4wMjFoLjMxbC45NjItNC41MzVoLjE1MWwyLjc0MSw0LjUzNWgxLjYzOWwtMi4zNy0zLjc2MS0uMjMyLS4zNjljLS4xLS4xNjYtLjIxMS0uMzM3LS4zMTctLjUsMi4yNS0uMTM0LDMuOC0xLjQ3LDMuOC0zLjNtLTEuMzkzLjE0NmMwLDEuMy0xLjE1NiwyLjE3Ni0yLjg3NiwyLjE3Ni0uMzM3LDAtLjcxMy0uMDEtLjkyNi0uMDJsLjcxMy0zLjMzM2MuMjk0LS4wMjMuNzIxLS4wMzYsMS4yMTktLjAzNiwxLjI1OCwwLDEuODcuNCwxLjg3LDEuMjE0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTU5LjA1OSAtMC4wMDEpIiBmaWxsPSIjZmZmIj48L3BhdGg+CiAgICA8cGF0aCBkPSJNMjYwLjQ4LDEuMjE3aDQuMTdsLjIzNy0xLjEzaC01LjUyNGwtMS45MDgsOS4wMDhhLjg3OC44NzgsMCwwLDAsLjg1OSwxLjA2aDQuNDQxTDI2Mi45OTEsOWgtNC4xNjhsLjc1My0zLjQ2M2gzLjk4MWwuMjM3LTEuMTNoLTMuOThaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTkyLjY1OCAtMC4wNjUpIiBmaWxsPSIjZmZmIj48L3BhdGg+CiAgICA8cGF0aCBkPSJNMzA3Ljc2Mi4wODdsLS41ODgsMi43ODdjLS4zNCwxLjYwNi0uNzYsMy44MTMtMS4wMTIsNS4xOTUtLjEyOS0uNTIxLS4yODYtMS4wNjctLjQ2MS0xLjZMMzAzLjc2OC4wODdoLTEuNTc2bC0xLjg4Niw4LjlhLjk2NS45NjUsMCwwLDAsLjk0NCwxLjE2NWguMWwuNjc2LTMuMTA5Yy4yOTUtMS40MzYuNzIyLTMuNjI4Ljk1OC00Ljk0Mi4xMjMuNDgxLjI0Ny45MS40MTIsMS40MzhsMS45NzgsNi42MTNoMS41NjFMMzA5LjA3My4wODdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjI0LjcyNSAtMC4wNjUpIiBmaWxsPSIjZmZmIj48L3BhdGg+CiAgPC9nPgo8L3N2Zz4K" alt="Arena BRB">
      <div class="header-text">
        <h1>Roadmap Arena BRB</h1>
        <p>Set/2025 - Mar/2026</p>
      </div>
      <div class="firebase-status">
        <div id="firebaseStatus" class="status-dot"></div>
        <span id="firebaseStatusText" class="status-text">Conectando...</span>
      </div>
    </div>

    <!-- Stats -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-label">Projetos em ExecuÃ§Ã£o</div>
        <div class="stat-value" id="statProjetos">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Pipeline de Projetos</div>
        <div class="stat-value" id="statPipeline">0</div>
      </div>
    </div>

    <!-- Total -->
    <div class="total-card">
      <div style="font-size: 20px; opacity: 0.95; font-weight: 600;">Total Geral de Projetos</div>
      <div class="total-card-value" id="statTotal">0</div>
      <div style="font-size: 16px; opacity: 0.9;"><span id="statTotalDesc">0 em execuÃ§Ã£o + 0 em pipeline</span></div>
    </div>

    <!-- Projetos em ExecuÃ§Ã£o -->
    <div class="section">
      <div class="section-title">
        <span>ðŸ“Š Projetos em ExecuÃ§Ã£o</span>
        <button class="btn btn-primary" onclick="abrirModalNovoProjeto(true)">+ Novo Projeto</button>
      </div>
      <div class="roadmap-container">
        <div class="roadmap" id="roadmapProjetos"></div>
      </div>
    </div>

    <!-- Pipeline -->
    <div class="section">
      <div class="section-title">
        <span>ðŸš€ Pipeline</span>
        <button class="btn btn-secondary" onclick="abrirModalNovoProjeto(false)">+ Novo Projeto</button>
      </div>
      <div class="roadmap-container">
        <div class="roadmap" id="roadmapPipeline"></div>
      </div>
    </div>
  </div>

  <!-- BotÃ£o Flutuante -->
  <button class="floating-btn" onclick="window.print()">ðŸ“¥ EXPORTAR PDF</button>

  <!-- Modais -->
  <div id="modalTarefa" class="modal" onclick="if(event.target===this) fecharModal('modalTarefa')">
    <div class="modal-content">
      <h2 class="modal-title">Nova Tarefa</h2>
      <div class="form-group">
        <label>Nome da Tarefa</label>
        <input type="text" id="inputTarefaNome" placeholder="Digite o nome">
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary" onclick="adicionarTarefa()">Adicionar</button>
        <button class="btn" style="background: #6B7280; color: white;" onclick="fecharModal('modalTarefa')">Cancelar</button>
      </div>
    </div>
  </div>

  <div id="modalProjeto" class="modal" onclick="if(event.target===this) fecharModal('modalProjeto')">
    <div class="modal-content">
      <h2 class="modal-title">Novo Projeto</h2>
      <div class="form-group">
        <label>Nome do Projeto</label>
        <input type="text" id="inputProjetoNome">
      </div>
      <div class="form-group">
        <label>Cor</label>
        <input type="color" id="inputProjetoCor" value="#FEF3C7" style="height: 50px;">
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary" onclick="adicionarProjeto()">Adicionar</button>
        <button class="btn" style="background: #6B7280; color: white;" onclick="fecharModal('modalProjeto')">Cancelar</button>
      </div>
    </div>
  </div>

  <div id="modalPercentual" class="modal" onclick="if(event.target===this) fecharModal('modalPercentual')">
    <div class="modal-content">
      <h2 class="modal-title">Editar Progresso</h2>
      <div class="form-group">
        <label>Percentual (%)</label>
        <input type="number" id="inputPercentual" min="0" max="100">
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary" onclick="salvarPercentual()">Salvar</button>
        <button class="btn" style="background: #6B7280; color: white;" onclick="fecharModal('modalPercentual')">Cancelar</button>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyDIoRUQYh7N6eAfCxmx5ToN4-LL519hip8",
  authDomain: "roadmap-arena-brb.firebaseapp.com",
  databaseURL: "https://roadmap-arena-brb-default-rtdb.firebaseio.com",
  projectId: "roadmap-arena-brb",
  storageBucket: "roadmap-arena-brb.firebasestorage.app",
  messagingSenderId: "497663406664",
  appId: "1:497663406664:web:22c9aef77aec1e26edde7d"
    };

    let app, database;
    try {
      app = firebase.initializeApp(firebaseConfig);
      database = firebase.database();
      
      const connectedRef = database.ref('.info/connected');
      connectedRef.on('value', (snap) => {
        const dot = document.getElementById('firebaseStatus');
        const text = document.getElementById('firebaseStatusText');
        if (snap.val()) {
          dot.classList.add('connected');
          text.textContent = 'Conectado';
        } else {
          dot.classList.remove('connected');
          text.textContent = 'Desconectado';
        }
      });
    } catch (error) {
      console.error('Firebase erro:', error);
    }

    const meses = [
      { label: 'Set', ano: 2025 }, { label: 'Out', ano: 2025 },
      { label: 'Nov', ano: 2025 }, { label: 'Dez', ano: 2025 },
      { label: 'Jan', ano: 2026 }, { label: 'Fev', ano: 2026 },
      { label: 'Mar', ano: 2026 }
    ];

    let projetos = [];
    let pipeline = [];
    let projetoSelecionado = null;
    let tarefaSelecionada = null;
    let isProjetoList = true;

    function sincronizarComFirebase() {
      if (!database) return;
      database.ref('roadmap').set({
        projetos, pipeline,
        timestamp: new Date().toISOString()
      }).then(() => mostrarMensagem('âœ… Salvo', 'success'))
        .catch(e => mostrarMensagem('âŒ Erro', 'error'));
    }

    function carregarDoFirebase() {
      if (!database) {
        carregarDadosIniciais();
        return;
      }
      
      database.ref('roadmap').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
          projetos = data.projetos || [];
          pipeline = data.pipeline || [];
        } else {
          carregarDadosIniciais();
        }
        renderizar();
      });
    }

    function carregarDadosIniciais() {
      projetos = [
        { id: 1, nome: "WiFi Staff", cor: "#D1FAE5", tarefas: [] },
        { id: 2, nome: "CFTV GNN", cor: "#CCFBF1", tarefas: [] },
        { id: 3, nome: "Catracas GNN", cor: "#E0E7FF", tarefas: [] }
      ];
      pipeline = [
        { id: 4, nome: "FIFA - PTA2", cor: "#E9D5FF", tarefas: [] },
        { id: 5, nome: "Cabeamento", cor: "#CCFBF1", tarefas: [] }
      ];
      renderizar();
      sincronizarComFirebase();
    }

    function mostrarMensagem(texto, tipo) {
      const msg = document.getElementById('saveMessage');
      msg.textContent = texto;
      msg.className = `save-message ${tipo}`;
      msg.style.display = 'block';
      setTimeout(() => msg.style.display = 'none', 2000);
    }

    function getCorPorPercentual(p) {
      p = p || 0;
      if (p <= 50) {
        const r = Math.round(107 + (210-107)*(p/50));
        return `rgb(255, ${r}, 53)`;
      }
      const r = Math.round(255 - (255-16)*((p-50)/50));
      const g = Math.round(210 - (210-185)*((p-50)/50));
      return `rgb(${r}, ${g}, 129)`;
    }

    function renderizar() {
      renderizarStats();
      renderizarRoadmap('roadmapProjetos', projetos, true);
      renderizarRoadmap('roadmapPipeline', pipeline, false);
    }

    function renderizarStats() {
      document.getElementById('statProjetos').textContent = projetos.length;
      document.getElementById('statPipeline').textContent = pipeline.length;
      document.getElementById('statTotal').textContent = projetos.length + pipeline.length;
      document.getElementById('statTotalDesc').textContent = `${projetos.length} em execuÃ§Ã£o + ${pipeline.length} em pipeline`;
    }

    function renderizarRoadmap(id, data, isProjetos) {
      const el = document.getElementById(id);
      if (!el) return;
      
      let html = `
        <div class="roadmap-header">
          <div style="width: 200px; font-weight: 700;">PROJETO</div>
          <div style="flex: 1; display: flex;">
            ${meses.map(m => `
              <div style="flex: 1; text-align: center; border-left: 2px solid #E5E7EB; padding: 8px;">
                <div style="font-size: 18px; font-weight: 700;">${m.label}</div>
                <div style="font-size: 13px; color: #6B7280;">${m.ano}</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;

      if (!data.length) {
        html += `<div style="text-align: center; padding: 60px; color: #9CA3AF;">
          <div style="font-size: 48px;">ðŸ“‹</div>
          <p style="font-size: 16px; margin: 15px 0;">Nenhum projeto</p>
        </div>`;
      } else {
        data.forEach(p => {
          const h = Math.max(70, (p.tarefas?.length || 0) * 60 + 20);
          html += `
            <div class="projeto-row">
              <div class="projeto-label" style="background: ${p.cor}; min-height: ${h}px;">${p.nome}</div>
              <div class="projeto-timeline" style="min-height: ${h}px;">
                ${meses.map((_, i) => `<div class="mes-col" style="left: ${i*100/meses.length}%; width: ${100/meses.length}%;"></div>`).join('')}
                ${(p.tarefas||[]).map((t, i) => `
                  <div class="tarefa-box" style="background: ${getCorPorPercentual(t.percentualEntrega||0)}; left: ${t.posicaoInicio||0}%; width: ${t.largura||25}%; top: ${i*60+10}px;">
                    <span style="flex: 1; overflow: hidden; text-overflow: ellipsis;">${t.nome}</span>
                    <span onclick="editarPercentual(${p.id}, ${t.id}, ${isProjetos})" style="cursor: pointer; padding: 5px 10px; background: rgba(255,255,255,0.3); border-radius: 4px;">${t.percentualEntrega||0}%</span>
                  </div>
                `).join('')}
                <button style="position: absolute; top: 10px; right: 10px; width: 36px; height: 36px; border-radius: 50%; border: none; background: ${isProjetos?'#0E76E0':'#4324C4'}; color: white; cursor: pointer; font-size: 20px;" onclick="abrirModalTarefa(${p.id}, ${isProjetos})">+</button>
              </div>
            </div>
          `;
        });
      }

      el.innerHTML = html;
    }

    function abrirModalNovoProjeto(isP) {
      isProjetoList = isP;
      document.getElementById('inputProjetoNome').value = '';
      document.getElementById('modalProjeto').classList.add('show');
    }

    function adicionarProjeto() {
      const nome = document.getElementById('inputProjetoNome').value.trim();
      const cor = document.getElementById('inputProjetoCor').value;
      if (!nome) return alert('Digite um nome!');
      
      const novo = { id: Date.now(), nome, cor, tarefas: [] };
      (isProjetoList ? projetos : pipeline).push(novo);
      sincronizarComFirebase();
      fecharModal('modalProjeto');
    }

    function abrirModalTarefa(pId, isP) {
      projetoSelecionado = pId;
      isProjetoList = isP;
      document.getElementById('inputTarefaNome').value = '';
      document.getElementById('modalTarefa').classList.add('show');
    }

    function adicionarTarefa() {
      const nome = document.getElementById('inputTarefaNome').value.trim();
      if (!nome) return alert('Digite um nome!');
      
      const data = isProjetoList ? projetos : pipeline;
      const proj = data.find(p => p.id === projetoSelecionado);
      if (proj) {
        if (!proj.tarefas) proj.tarefas = [];
        proj.tarefas.push({
          id: Date.now(),
          nome,
          posicaoInicio: 0,
          largura: 28,
          percentualEntrega: 0
        });
        sincronizarComFirebase();
      }
      fecharModal('modalTarefa');
    }

    function editarPercentual(pId, tId, isP) {
      projetoSelecionado = pId;
      tarefaSelecionada = tId;
      isProjetoList = isP;
      
      const data = isP ? projetos : pipeline;
      const proj = data.find(p => p.id === pId);
      const tarefa = proj?.tarefas?.find(t => t.id === tId);
      
      if (tarefa) {
        document.getElementById('inputPercentual').value = tarefa.percentualEntrega || 0;
        document.getElementById('modalPercentual').classList.add('show');
      }
    }

    function salvarPercentual() {
      const p = parseInt(document.getElementById('inputPercentual').value) || 0;
      if (p < 0 || p > 100) return alert('0-100 apenas!');
      
      const data = isProjetoList ? projetos : pipeline;
      const proj = data.find(p => p.id === projetoSelecionado);
      const tarefa = proj?.tarefas?.find(t => t.id === tarefaSelecionada);
      
      if (tarefa) {
        tarefa.percentualEntrega = p;
        sincronizarComFirebase();
      }
      fecharModal('modalPercentual');
    }

    function fecharModal(id) {
      document.getElementById(id).classList.remove('show');
    }

    window.addEventListener('DOMContentLoaded', carregarDoFirebase);
  </script>
</body>
</html>
